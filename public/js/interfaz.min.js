$(document).ready(function(){$("a[rel=#loginOverlay]").overlay({onBeforeLoad:function(){$("#form_login .usuario").val("");$("#form_login .passwd").val("");$("#form_login .usuario").focus()},onLoad:function(b,a){$("#form_login .usuario").focus()},onClose:function(a){}});$("a[rel=#cond_usoOverlay]").overlay({onBeforeLoad:function(){},onLoad:function(b,a){},onClose:function(a){}});$(".opciones_radio .opcion").click(function(){$(this).find("input").attr("checked","checked")});$(".enrollable legend").click(function(){$(this).next().slideToggle(function(){$(this).parent().toggleClass("desplegado")})});$("#listado-ficheros tr.permitido").click(function(){var a=$(this).attr("id").replace(/fichero-/,"");top.location.href=url_base+a});$("#listado-ficheros tr").cluetip({showTitle:false,width:"300px",cluetipClass:"jtip",ajaxCache:true,hoverIntent:{sensitivity:1,interval:100,timeout:100}});$("#version_consigna span").click(function(){$("#version_consigna span.p").html('<img src="'+url_base+'img/logos/pistacho.gif" alt="pistachito" />')})});function pagina_login(){$(".usuario").focus()}function pagina_envio(){$(".enrollable legend").trigger("click");$("#form_subida").attr("target","iframe_upload");var a=$("#form_subida").attr("action");$("#form_subida").attr("action",a+"/desatendido");$(".opcion").click(function(){var d=$(this).children("input");var b=d.attr("name");if(b=="tipoacceso"){var c=d.val();actualiza_prevision(c)}});$("#form_subida").submit(function(){$("div.error").remove();var f=$("input[name=fichero]").val();var d=$("input[name=fichero_passwd]").val();var c=$("input[name=tipoacceso]:checked").val();var b="";if(f==""){b+="<p>Debe especificar un fichero</p>"}if(d==""&&(c==1||user_auth=="")){b+="<p>Dado que el acceso al fichero será público, debe especificar una contraseña para el mismo</p>"}if(b!=""){$(this).before('<div class="cuadro error">'+b+"</div>");var e=$(".error").offset().top;$("html,body").animate({scrollTop:e},"fast","swing");return false}$("#iframe_upload").remove();$("body").append('<iframe name="iframe_upload" id="iframe_upload" onload="javascript:fin_envio();"></iframe>');$("#progreso").html("0%");$("#progreso").width("0%");$("#progreso_velocidad").html("- kB/s");$.blockUI({message:$("#progreso_overlay"),applyPlatformOpacityRules:false,css:{width:"300px"}});$("#progreso").everyTime(3000,"contador",function(){$.ajax({url:url_base+"ficheros/estado/"+$("#id_envio").val(),cache:false,dataType:"text",success:function(h){if(h!="noimplementado"&&h!="nulo"){var g=h.split(";");$("#progreso").html(g[0]+"%");$("#progreso").width(g[0]+"%");$("#progreso_velocidad").html(g[1]);$("#progreso_restante").html(g[2])}else{$("#progreso_velocidad").html("- kB/s");$("#progreso_restante").html("-")}},error:function(i,h,g){$("#progreso_velocidad").html("¿? kB/s");$("#progreso_restante").html("desconocido")}})},0,true)})}function fin_envio(){$("#progreso").stopTime("contador");$("#iframe_upload").stop();$("#progreso").html("100%");$("#progreso").width("100%");var b=$("#iframe_upload").contents().text();if(b.match(/^\d+$/)){if(user_auth==""){top.location.href=url_base}else{top.location.href=url_base+"/ficheros/propios"}return}else{$("#form_subida").before('<div class="cuadro error">'+b+"</div>");var a=$(".error").offset().top;$("html,body").animate({scrollTop:a},"fast","swing")}$.unblockUI()}function pagina_descarga(a){$("#passwd_fichero").focus();$("#cuadro_password_fichero").each(function(){$(".descarga_fichero").click(function(){$("#passwd_fichero").focus()})});if(activar_antivirus){$("#info_av.pendiente").everyTime(5000,"contador",function(){$.ajax({url:url_base+"ficheros/estadoav/"+a,cache:false,dataType:"text",success:function(b){if(b!=""){$("#info_av").stopTime("contador");$("#info_av").replaceWith(b)}},error:function(d,c,b){$("#info_av").html("Error desconocido al consultar vía AJAX")}})},0,true)}$("#historico_detallado").hide();$("#ver_historico_detallado").click(function(){$("#historico_detallado").toggle("normal")})}function pagina_modificacion(){if($("input[name=tipoacceso]:checked").val()==1){$(".eliminar-passwd").attr("disabled",true)}$(".eliminar-passwd").change(function(){if($(this).attr("checked")==true){$(".passwd-fichero").val("");$(".passwd-fichero").attr("disabled",true)}else{$(".passwd-fichero").attr("disabled",false)}});$(".opcion").click(function(){var c=$(this).children("input");var a=c.attr("name");if(a=="tipoacceso"){var b=c.val();if(b==0){$(".eliminar-passwd").attr("disabled",false)}else{$(".eliminar-passwd").attr("disabled",true)}$(".eliminar-passwd").attr("checked",false);$(".passwd-fichero").attr("disabled",false)}actualiza_prevision(b)})}function actualiza_prevision(a){if(a==0){$("#prevision-peor-caso img").attr("src",url_base+"/img/interfaz/cancelar.png")}else{$("#prevision-peor-caso img").attr("src",url_base+"/img/interfaz/vale.png")}};